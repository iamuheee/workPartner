<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mailMapper">

	<resultMap id="empResult" type="Employee">
		<result column="emp_no" property="empNo" />
		<result column="emp_id" property="empId" />
		<result column="emp_pwd" property="empPwd" />
		<result column="emp_name" property="empName" />
		<result column="emp_phone" property="empPhone" />
		<result column="emp_extension" property="empExtension" />
		<result column="emp_email" property="empEmail" />
		<result column="emp_exemail" property="empExEmail" />
		<result column="emp_enrolldate" property="empEnrollDate" />
		<result column="emp_retiredate" property="empRetireDate" />
		<result column="emp_modifydate" property="empModifyDate" />
		<result column="emp_status" property="empStatus" />
		<result column="emp_profile" property="empProfile" />		
		<result column="emp_nt_admin" property="empNtAdmin" />
		<result column="dep_cd" property="depCd" />
		<result column="pos_cd" property="posCd" />	
		<result column="emp_sig_use" property="empSigUse" />		
	</resultMap>
	
	<resultMap id="mailResult" type="Mail">
		<result column="mail_no" property="mailNo"/>
		<result column="mail_title" property="mailTitle"/>
		<result column="mail_content" property="mailContent"/>
		<result column="mail_create_date" property="mailCreateDate"/>
		<result column="mail_important" property="mailImportant"/>
		<result column="mail_security" property="mailSecurity"/>
		<result column="mail_file" property="mailFile"/>
		<result column="mail_recipient" property="mailRecipient"/>
		<result column="mail_cc" property="mailCC"/>
		<result column="mail_sender" property="mailSender"/>
		<result column="mail_sender_name" property="mailSenderName"/>
	</resultMap>
	
	<resultMap id="statusResult" type="MailStatus">
		<result column="mail_no" property="mailNo"/>
		<result column="mail_email" property="mailEmail"/>
		<result column="mail_status" property="mailStatus"/>
		<result column="mail_category" property="mailCategory"/>
		<result column="mail_read" property="mailRead"/>
		<result column="mail_star" property="mailStar"/>
	</resultMap>
	
	<resultMap id="sigResult" type="Signature">
		<result column="sig_no" property="sigNo"/>
		<result column="emp_no" property="empNo"/>
		<result column="sig_name" property="sigName"/>
		<result column="sig_dep" property="sigDepartment"/>
		<result column="sig_position" property="sigPosition"/>
		<result column="sig_address" property="sigAddress"/>
		<result column="sig_extension" property="sigExtension"/>
		<result column="sig_tel" property="sigTel"/>
		<result column="sig_email" property="sigEmail"/>
		<result column="sig_status" property="sigStatus"/>
		<result column="sig_basic" property="sigBasic"/>
		<result column="rnum" property="rnum"/>
	</resultMap>
	
	<resultMap id="fileResult" type="File">
		<result column="file_no" property="fileNo"/>
		<result column="file_ref_no" property="refNo"/>
		<result column="file_category" property="fileCategory"/>
		<result column="file_origin_name" property="fileOriginName"/>
		<result column="file_change_name" property="fileChangeName"/>
		<result column="file_path" property="filePath"/>
		<result column="file_upload_date" property="fileUploadDate"/>
		<result column="file_level" property="fileLevel"/>
		<result column="file_status" property="fileStatus"/>		
	</resultMap>
	
	<!-- 등록된 서명 조회  -->
	<select id="selectSigList" resultMap="sigResult">
		SELECT ROWNUM RNUM, A.*
	      FROM (
	            SELECT  sig_no
	                  , emp_no		      
	                  , sig_name
	                  , sig_dep
	                  , sig_position
	                  , CASE WHEN sig_address = 'N' THEN ' '
	                    WHEN sig_address = 'Y' THEN '서울특별시 금천구 가산디지털2로 115'
	                    END "sig_address"
	                  , sig_extension  
	                  , sig_tel
	                  , sig_email
	                  , sig_basic
	              from  tb_signature 
	             where emp_no = #{empNo}
	               and sig_status = 'Y'
	             ) A             
	</select>
	
	<!-- 서명 삭제  -->
	<update id="deleteSig">
		update 
		        tb_signature 
		    set sig_status = 'N'
		  where sig_no =  #{sigNo}	
	</update>
	
	<!-- 기본서명 조회 -->
	<select id="selectSigBasic" resultMap="sigResult">
		    SELECT  sig_no
	              , emp_no		      
	              , sig_name
	              , sig_dep
	              , sig_position
	              , CASE WHEN sig_address = 'N' THEN ' '
	                WHEN sig_address = 'Y' THEN '서울특별시 금천구 가산디지털2로 115'
	                END "sig_address"
	              , sig_extension  
	              , sig_tel
	              , sig_email
	              , sig_basic
	          from  tb_signature 
	         where emp_no = #{empNo}
	           and sig_status = 'Y'
	           and sig_basic = 'Y'
	</select>
			
	<!-- 기본서명 갯수 조회  -->
	<select id="selectBasicCount" resultType="_int">
		    SELECT count(*)
	          from tb_signature 
	         where emp_no = #{empNo}
	           and sig_status = 'Y'
	           and sig_basic = 'Y'
	</select>
	
	<!-- 기본설정된 서명이 없을 경우 실행 될 것  -->
	<!-- rnum 1인 서명이 자동으로 기본으로 될 것 -->	
	<update id="updateBasic">
	  update
             tb_signature
         set sig_basic = 'Y'
       where sig_no = ( 
                       select sig_no
                            from (
                                    (
                                     select *
                                       from (
                                          select ROWNUM RNUM, A.*
                                            from (
                                                  select  sig_no
                                                        , emp_no
                                                        , sig_basic
                                                    from  tb_signature 
                                                   where emp_no = #{empNo}
                                                     and sig_status = 'Y'
                                                   ) A
                                              )
                                        where  rnum = 1 
                                       ) 
                                   )
                        )
	
	</update>
	
	<insert id="insertSig">
		insert 
		  into tb_signature
		 	 (
			  	sig_no
	          , emp_no		      
	          , sig_name
	          , sig_dep
	          , sig_position
	          , sig_address           
	          , sig_extension  
	          , sig_tel
	          , sig_email          	  
		 	 )
			  values
			  (
			    SEQ_SIGNO.nextval
			  , #{empNo}
			  , #{sigName}
			  , #{sigDepartment}
			  , #{sigPosition}
			  , #{sigAddress}
			  , #{sigExtension}
			  , #{sigTel}
			  , #{sigEmail}
			  )		  
	</insert>
	
	<update id="updateSigUseManage">
		update 
			   tb_employee
		   set emp_sig_use = #{empSigUse}
		 where emp_no = #{empNo}	   	 		
	</update>
	
	<update id="updateSigBasicNo">
		update 
				tb_signature
		   set  sig_basic = 'N'
	</update>
	
	<update id="updateSigBasicManage">
		update 
				tb_signature
		   set  sig_basic = 'Y'
		 where  sig_no = #{sigNo} 		
	</update>	
	
	<insert id="insertMail">
		insert
		  into tb_mail
		  		(
			  		mail_no,
					mail_title,
					mail_content,
					mail_important,
					mail_security,
					mail_file,
					mail_recipient,
					mail_cc,
					mail_sender,
					mail_sender_name	
		  		)
		  values
		  		(
		  		    SEQ_MANO.nextval
		  		  , #{mailTitle} 
		  		  , #{mailContent} 
		  		  , #{mailImportant} 
		  		  , #{mailSecurity} 
		  		  , #{mailFile} 
		  		  , #{mailRecipient} 
		  		  , #{mailCC} 
		  		  , #{mailSender} 
		  		  , #{mailSenderName} 		
		  		)			  		
	</insert>
	
	<insert id="insertMailStatusRev">
		insert
		  into tb_mail_status
		  		 (
		  		   mail_no
		  		 , mail_email
		  		 , mail_category		  			
		 		  )
		   values
		  		 (
		  		   seq_mano.currval
		  		 , #{mailEmail}
		  		 , 'R'  
		  		 )	  
	</insert>
	<insert id="insertMailStatusCC">
		insert
		  into tb_mail_status
		  		 (
		  		   mail_no
		  		 , mail_email
		  		 , mail_category		  		 	
		 		  )
		   values
		  		 (
		  		   seq_mano.currval
		  		 , #{mailEmail}
		  		 , 'C'  
		  		 )	  
	</insert>
	<insert id="insertMailStatusSen">
		insert
		  into tb_mail_status
		  		 (
		  		   mail_no		  		 
		  		 , mail_category
		  		 , mail_read		
		 		  )
		   values
		  		 (
		  		   seq_mano.currval		  	
		  		 , 'S'  
		  		 , 'Y'
		  		 )	  
	</insert>
	
	<insert id="insertMailFile">
		insert
		  into  tb_file
		     (
		    	file_no
		      , file_ref_no
		      , file_category	
		      , file_origin_name
		      , file_change_name
		      , file_path		      
		   	 )		    
		values
		  	 (
		  	 	SEQ_FILENO.nextval
		  	  , seq_mano.currval
		  	  , 5
		  	  , #{fileOriginName}
		  	  , #{fileChangeName}
		  	  , #{filePath}		  	
		  	 )  
		  
	</insert>
	

</mapper>