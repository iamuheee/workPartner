<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="bookMapper">
	
	<resultMap id="bookResult" type="Book">
		<result column="bk_no" property="bkNo" />
		<result column="emp_no" property="empNo" />
		<result column="rm_no" property="rmNo" />
		<result column="bk_person" property="bkPerson" />
		<result column="bk_title" property="bkTitle" />
		<result column="bk_meetdate" property="bkDate" />
		<result column="bk_start" property="bkStart" />
		<result column="bk_end" property="bkEnd" />
		<result column="bk_status" property="bkStatus"/>
		<collection property="room" resultMap="roomResult"/>
	</resultMap>
	
	<resultMap id="roomResult" type="Room">
		<result column="rm_name" property="rmName"/>
	</resultMap>
	
	<!-- 회의실 예약 등록 -->
	<!-- 작성자 : 박태은 -->
	<insert id="insertBook">
		insert
		  into tb_book
		  (
		    bk_no
		  , emp_no
		  , rm_no
		  , bk_person
		  , bk_title
		  , bk_meetdate
		  , bk_start
		  , bk_end
		  )
		  values
		  (
		  	seq_bkno.nextval
		  , #{ empNo }
		  , #{ rmNo }
		  , #{ bkPerson }
		  , #{ bkTitle }
		  , #{ bkDate }
		  , #{ bkStart }
		  , #{ bkEnd }
		  )
	</insert>
	
	<!-- 내 예약 건수(listCount) 조회 -->
	<!-- 작성자 : 박태은 -->
	<select id="selectListCount" resultType="_int">
		select
		       count(*)
		  from tb_book
		 where emp_no = #{ empNo }
	</select>
	
	<!-- 내 예약 현황 목록 조회 -->
	<!-- 작성자 : 박태은 -->
 	<select id="selectBookList" resultMap="bookResult">
		select
		       bk_no
		     , rm_name
		     , bk_title
		     , bk_meetdate
		     , bk_start
		     , bk_end
		     , bk_status
		  from tb_book
		  join tb_room using(rm_no)
		 where emp_no = #{empNo}
		 order
		    by bk_meetdate desc
	</select> 
	
	<!-- 내 예약 상세조회 -->
	<!-- 작성자 : 박태은 -->
	<select id="selectBook" resultMap="bookResult">
		select
		       bk_no
		     , rm_name
		     , bk_title
		     , bk_meetdate
		     , bk_start
		     , bk_end
		     , bk_person
		  from tb_book
		  join tb_room using(rm_no)
		 where bk_no = #{ bkNo }
	</select>

</mapper>
